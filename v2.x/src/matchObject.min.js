!function(){function d(q,r,t,u,w,z,A){function B(G){let H=G.toUpperCase().match(/[A-Za-z]/g),I=G.match(/[*#@]/g);if(H&&(H=H.join('')),I&&(I=I.join('')),0<='SAQDRP'.split('').indexOf(H+''))return 0<=['S','A','Q'].indexOf(H)&&(D=E),0<=['D','R','P'].indexOf(H)&&(D=1-E),0<=['Q','P'].indexOf(H)&&(F.result='Penalty'),'A'==H&&(F.result='Ace'),'D'==H&&(F.first_serve={error:'Error',serves:['0e']},F.result='Double Fault'),I&&!F.result&&('*'==I&&(F.result='Winner'),'#'==I&&(F.result='Forced Error'),'@'==I&&(F.result='Unforced Error')),F.code=G,F.winner=parseInt(D),G===G.toLowerCase()&&(F.first_serve={error:'Error',serves:['0e']}),F}function C(G){if(G=G.replace(':','-').split('-').map((L)=>L.trim()).join('-').split('D').join('40'),2!=G.split('-').length)return!1;let H=A.points,I=(L)=>L.reduce((M,N)=>M+N);if(u.tiebreak()){let L=G.split('-').map((O)=>parseInt(O)),M=H.split('-').map((O)=>parseInt(O));if(!g(L)||2!=L.length)return!1;if(I(M)+1!=I(L))return!1;let N=[Math.abs(L[0]-M[0]),Math.abs(L[1]-M[1])];return F.winner=N.indexOf(1),F}let J=Object.assign({},l);if(u.hasDecider()&&Object.keys(k).forEach((L)=>J[L]=k[L]),'0-0'==G&&0<=J[H].join('-').indexOf('G'))return F.winner=t.points.indexOf(Math.max(...t.points)),F;void 0==J[H]&&(H='0-0');let K=!!J[H]&&J[H].indexOf(G);if(0<=K)return z&&r&&(K=1-K),F.winner=K,F}if(q==void 0)return!1;if(1==q.toString().length&&!isNaN(q)){let G=+q==r?'S':'R';return!(0>[0,1].indexOf(+q))&&{winner:+q,server:r,code:G}}let D,E=w.map((G)=>0<=G.indexOf(r)).indexOf(!0),F={server:r};if('object'==typeof q){if(void 0!=q.winner&&0<=[0,1].indexOf(+q.winner))return q.winner=parseInt(q.winner),q.code=q.code?q.code:q.winner==r?'S':'R',q.first_serve&&(q.code=q.code.toLowerCase()),Object.assign({},q,F);if(q.code&&B(q.code))return Object.assign({},q,F)}if('string'==typeof q){if(C(q))return F;if(B(q))return F}}function g(q){return!!Array.isArray(q)&&!(0<=q.map((r)=>!isNaN(r)).indexOf(!1))}let h=function(){};h.addPoint_events=[],h.undo_events=[],h.reset_events=[],h.pointParser=d;let j={games:{advantage:{description:'Advantage Game',tiebreak:!1,hasDecider:!1,threshold:4,minDiff:2},noAdvantage:{description:'No Advantage Game',tiebreak:!1,hasDecider:!0,threshold:4,minDiff:1},tiebreak7a:{description:'Tiebreak to 7',tiebreak:!0,hasDecider:!1,threshold:7,minDiff:2},tiebreak10a:{description:'Tiebreak to 10',tiebreak:!0,hasDecider:!1,threshold:10,minDiff:2},tiebreak12a:{description:'Tiebreak to 10',tiebreak:!0,hasDecider:!1,threshold:12,minDiff:2},tiebreak9n:{description:'Tiebreak to 9, Golden Point',tiebreak:!0,hasDecider:!0,threshold:9,minDiff:1}},sets:{AdSetsTo6tb7:{description:'Advantage, 6 games for set, Tiebreak to 7',hasDecider:!0,threshold:6,minDiff:2,children:'advantage',decidingChild:'tiebreak7a'},NoAdSetsTo6tb7:{description:'No-Ad, 6 games for set, Tiebreak to 7',hasDecider:!0,threshold:6,minDiff:2,children:'noAdvantage',decidingChild:'tiebreak7a'},longSetTo6by2:{description:'Advantage, 6 games for set, win by 2 games',hasDecider:!1,threshold:6,minDiff:2,children:'advantage',decidingChild:'advantage'},supertiebreak:{description:'Supertiebreak',hasDecider:!0,threshold:1,minDiff:1,children:'tiebreak10a',decidingChild:'tiebreak10a'},pro10a12:{description:'10 Game No Ad Pro Set; tiebreak to 12',hasDecider:!0,threshold:10,minDiff:2,children:'noAdvantage',decidingChild:'tiebreak12a'},pro8a7:{description:'8 Game Pro Set; tiebreak to 7',hasDecider:!0,threshold:8,minDiff:2,children:'advantage',decidingChild:'tiebreak7a'}},matches:{'3_6a_7':{name:'Standard Advantage',description:'best of 3 sets, Advantage, 6 games for set, Tiebreak to 7',hasDecider:!0,threshold:2,minDiff:0,children:'AdSetsTo6tb7',decidingChild:'AdSetsTo6tb7'},'3_6n_7':{name:'Standard No-Advantage',description:'best of 3 sets, No Advantage, 6 games for set, Tiebreak to 7',hasDecider:!0,threshold:2,minDiff:0,children:'NoAdSetsTo6tb7',decidingChild:'NoAdSetsTo6tb7'},'3_6n_10':{name:'No-Ad, 3rd Set Supertiebreak',description:'best of 3 sets, No-Ad, 6 games for set, Tiebreak to 7, final set Supertiebreak',hasDecider:!0,threshold:2,minDiff:0,children:'NoAdSetsTo6tb7',decidingChild:'supertiebreak'},'5_6a_7':{name:'US Open Men',description:'best of 5 sets, Advantage, 6 games for set, Tiebreak to 7',hasDecider:!0,threshold:3,minDiff:0,children:'AdSetsTo6tb7',decidingChild:'AdSetsTo6tb7'},'5_6a_7_long':{name:'Grand Slam Men - Final Advantage Set',description:'best of 5 sets, Advantage, 6 games for set, Tiebreak to 7, final set by 2 games',hasDecider:!0,threshold:3,minDiff:0,children:'AdSetsTo6tb7',decidingChild:'longSetTo6by2'},'3_6a_7_long':{name:'Grand Slam Women - Final Advantage Set',description:'best of 5 sets, Advantage, 6 games for set, Tiebreak to 7, final set by 2 games',hasDecider:!0,threshold:2,minDiff:0,children:'AdSetsTo6tb7',decidingChild:'longSetTo6by2'},'1_8a_7':{name:'8 Game Pro Set',description:'1 set, Advantage, 8 games for set, Tiebreak to 7',hasDecider:!0,threshold:1,minDiff:0,children:'pro8a7',decidingChild:'pro8a7'}}};h.formats=()=>j,h.newFormat=({type:q,code:r,description:t,tiebreak:u,hasDecider:w,threshold:z,minDiff:A,children:B,decidingChild:C}={})=>{let D=0<=Object.keys(j).indexOf(q),E=D&&0<=Object.keys(j[q]).indexOf(r);return D&&E?!1:(j[q][r]={description:t,tiebreak:u,hasDecider:w,threshold:z,minDiff:A,children:B,decidingChild:C},!0)},h.stateObject=({index:q,object:r,parent_object:t,child:u,format:w,common:z=h.common()}={})=>{let A={};A.child=u,A.format=w,A.child_attributes=['hasDecider','threshold','minDiff','tiebreak','code','description'],(A.reset=function(D){A.children=[],A.local_history=[],A.counter=[0,0],A.first_service=0,t||(z.metadata.reset(),z.metadata.resetStats(),z.history=[],z.perspective_score=!1,z.events.reset().forEach((E)=>E())),!t&&D&&(A.format.singles(!0),A.format.type(D))})(),A.set={index(D){return arguments.length?(isNaN(D)||(q=D),A.set):q},liveStats(D){return arguments.length?!(0>[!0,!1].indexOf(D))&&(D&&!z.live_stats&&A.history.points().length&&(z.metadata.resetStats(),z.stats.counters()),!D&&z.live_stats&&z.metadata.resetStats(),z.live_stats=D,A.set):z.live_stats},perspectiveScore(D){return arguments.length?!A.history.points().length&&(0<=[!0,!1].indexOf(D)&&(z.perspective_score=D),A.set):z.perspective_score},firstService(D){return arguments.length?!(0>z.metadata.serviceOrder().indexOf(D))&&(A.first_service=D,A.set):A.first_service}},A.history={},A.history.local=()=>A.local_history,A.history.action=(D)=>z.history.filter((E)=>E.action==D),A.history.points=()=>z.history.filter((D)=>'addPoint'==D.action).map((D)=>D.point),A.history.score=()=>{return'Game'==r?A.history.points().map((D)=>D.score):[].concat(...A.children.map((D)=>D.history.score()))},A.history.games=()=>'Set'==r?A.local_history:[].concat(...A.children.map((D)=>D.history.games())),A.history.lastPoint=()=>{let D=A.history.points();return D[D.length-1]||{score:'0-0'}},A.history.common=()=>z.history,A.score=()=>{let D={local:A.counter,points:'Game'==r?A.complete()?[0,0]:A.counter:A.lastChild()?A.lastChild().score().counters.points:[0,0],games:'Set'==r?A.complete()?[0,0]:A.counter:'Match'==r?A.lastChild()?A.lastChild().score().counters.games:[0,0]:void 0,sets:'Match'==r?A.counter:void 0},F={counters:D};return F.points='Game'==r?A.complete()?'0-0':A.scoreboard():A.lastChild()?A.lastChild().score().points:'0-0',F.games='Set'==r?A.complete()?'0-0':A.perspectiveScore().join('-'):A.lastChild()?A.lastChild().score().games:'0-0',F.sets='Match'==r?A.complete()?'0-0':A.perspectiveScore().join('-'):A.lastChild()?A.lastChild().score().sets:'0-0',F.components={},'Match'==r&&A.children.length&&(F.components.sets=A.children.map((G)=>{let H={games:G.score().counters.local};return G.lastChild()&&G.lastChild().format.tiebreak()&&(H.tiebreak=G.lastChild().score().counters.local),H})),F.display={},F},A.accessChildren=()=>A.children,A.lastChild=()=>A.children[A.children.length-1],A.scoreDifference=()=>Math.abs(A.counter[0]-A.counter[1]),A.thresholdMet=()=>Math.max(...A.counter)>=A.format.threshold(),A.minDifferenceMet=()=>A.scoreDifference()>=A.format.minDiff(),A.singleThresholdMet=()=>Math.max(...A.counter)>=A.format.threshold()&&Math.min(...A.counter)<A.format.threshold(),A.winner=()=>A.complete()?A.counter[0]>A.counter[1]?0:1:void 0,A.reverseScore=()=>z.perspective_score&&1==A.nextTeamServing()%2,A.nextTeamServing=()=>z.metadata.teams().map((D)=>0<=D.indexOf(A.nextService())).indexOf(!0),A.nextTeamReceiving=()=>z.metadata.teams().map((D)=>0<=D.indexOf(A.nextService())).indexOf(!1),A.perspectiveScore=(D=A.counter,E)=>{return void 0==E?A.reverseScore()?D.slice().reverse():D:E?D.slice().reverse():D},A.complete=()=>{return A.thresholdMet()&&A.minDifferenceMet()||function(){return A.counter[0]>=A.format.threshold()&&A.counter[1]>=A.format.threshold()}()&&A.scoreDifference()&&A.format.hasDecider()},A.nextService=()=>{if(A.complete())return!1;let D=A.lastChild();if(0>z.metadata.serviceOrder().indexOf(A.first_service)&&console.log('PROBLEM'),'Game'==r)return A.format.tiebreak()?z.nextTiebreakService(A.local_history,A.first_service):A.first_service;if(!D)return A.first_service;if(D.complete()){for(let E=D.lastChild();E;)D=E,E=D.lastChild();let F=D.set.firstService();return z.advanceService(F)}return D.nextService()},A.currentChild=()=>{if(A.complete())return!1;let D=A.lastChild();return D&&!D.complete()?D:A.newChild()},A.newChild=()=>{function D(N,O,P){P.forEach((Q)=>{if('function'==typeof N[Q]){let R=N[Q](),S=O[Q]();O[Q](R);O[Q]()}})}let F,E=A.lastChild();if(!E)F=A.first_service;else{for(let N=E.lastChild();N;)E=N,N=E.lastChild();F=z.advanceService(E.set.firstService())}let G=A.format.threshold(),H=A.format.minDiff(),I=(N)=>A.counter[0]==N&&A.counter[1]==N,J=I(G)&&(A.format.hasDecider()||1==H)||I(G-1)&&0==H,K=J?A.format.decidingChild.settings().code:A.format.children.settings().code,L=A.children.length,M=h[A.child.object]({index:L,parent_object:A,type:K,common:z});if(M.set.firstService(F),!K){let N=J?A.format.decidingChild:A.format.children;D(N,M.format,A.child_attributes),N.children&&(D(N.children,M.format.children,A.child_attributes),D(N.decidingChild,M.format.decidingChild,A.child_attributes))}return A.children.push(M),M};let B=(D)=>{if(A.complete())return{result:!1};let E=A.nextService(),F=z.pointParser(D,E,A.history.lastPoint(),A.format,z.metadata.teams(),A.set.perspectiveScore(),A.score());if(!F)return{result:!1};A.counter[F.winner]+=1;let G={points:A.counter.slice(),score:A.scoreboard(),number:A.local_history.filter((L)=>void 0!=L.winner).length,index:A.history.points().length,[r.toLowerCase()]:q},H=A.pointsToGame(),I=H?H.indexOf(1):void 0,J=0<=I&&I==1-z.metadata.playerTeam(E);J&&(G.breakpoint=!0),A.format.tiebreak()&&(G.tiebreak=!0),z.metadata.timestamps()&&!F.uts&&(G.uts=new Date().valueOf()),Object.assign(F,G),A.local_history.push(F);let K={action:'addPoint',result:!0,complete:A.complete(),point:F,needed:{points_to_game:H}};return z.history.push(K),K};A.addPoint=(D)=>{if(Array.isArray(D))return!1;if('Game'==r)return B(D);let E=A.currentChild();if(!E)return{result:!1};let F=E.addPoint(D);if(!F.result)return F;E.complete()&&(A.counter[F.point.winner]+=1,A.local_history.push({winner:F.point.winner,[A.child.plural]:A.counter.slice(),index:E.set.index()})),F.complete=A.complete(),F.next_service=A.nextService();let G=A.pointsNeeded?A.pointsNeeded():void 0;return G&&(F.needed=Object.assign({},F.needed,G)),F.point[A.child.label]=E.set.index(),F[A.child.label]={complete:E.complete(),winner:E.winner(),[A.child.plural]:A.counter.slice(),index:E.set.index()},t||z.addStatPoint(F),t||z.events.addPoint().forEach((H)=>H(F)),F},A.addPoints=(D=[])=>A.addMultiple({values:D}),A.addScore=(D)=>{let E=A.addPoint(D);if(E.result)return E;let F=A.history.lastPoint(),G=F&&'0-0'!=F.score?F.points:[0,0],H=G.reduce((J,K)=>J+K),I=A.change.pointScore(D);if(I.result){A.undo();let J=I.pointChange.to,K=J.reduce((M,N)=>M+N),L=J.map((M,N)=>{return{diff:M-G[N],i:N}}).filter((M)=>M.diff);if(1==L.length&&0<L[0].diff){let M,N=L[0].i,O=L[0].diff;for(let P=0;P<O;P++){if(M=A.addPoint(N),!M.result)return M;if(M.game.complete)return M}return M}}return{result:!1}},A.addScores=(D=[])=>A.addMultiple({values:D,fx:A.addScore}),A.addMultiple=({values:D=[],fx:E=A.addPoint})=>{'string'==typeof D&&(D=D.match(/[01A-Za-z][\*\#\@]*/g));let F=[],G=[];for(;D.length;){let H=D.shift(),I=E(H);I.result?F.push(I):(D.unshift(H),G=D.slice(),D=[])}return{result:F.length,added:F,rejected:G}},A.decoratePoint=(D,E)=>{let F=z.history.map((H,I)=>{if('addPoint'==H.action&&H.point.index==D.index)return I}).filter((H)=>void 0!=H);if(!F.length)return!1;let G=z.history[F[0]];G.point=Object.assign({},G.point,E)},A.change={},A.change.points=(D)=>{if(!g(D)||2!=D.length)return!1;if('Game'==r){let E=Math.max(...D)>A.format.threshold(),F=Math.abs(D[0]-D[1]);if(E&&F>A.format.minDiff())return!1;if(A.complete())return{result:!1};let G={action:'changePoints',result:!0,pointChange:{from:A.counter,to:D}};if(A.local_history.push(G),z.history.push(G),A.counter=D,A.complete()){let H=parseInt(A.winner());t.counter[H]+=1,t.local_history.push({winner:H,games:t.counter.slice(),index:q})}return G}return A.propagatePointChange(D,'points')},A.change.pointScore=(D)=>{if('0-0'==D)return A.change.points([0,0]);if('Game'==r){if(A.format.tiebreak())return A.change.points(D.split('-').map((I)=>parseInt(I)));D=D.replace(':','-').split('-').map((I)=>I.trim()).join('-').split('D').join('40');let E=Object.assign({},l);A.format.hasDecider()&&Object.keys(k).forEach((I)=>E[I]=k[I]);let F=[].concat(...Object.keys(E).map((I)=>E[I]));if(0>F.indexOf(D))return!1;let G=['0','15','30','40','A','G'],H=D.split('-').map((I)=>G.indexOf(I));return 5==H[0]&&3!=H[1]&&(H[0]=4),5==H[1]&&3!=H[0]&&(H[1]=4),A.change.points(H)}return A.propagatePointChange(D,'pointScore')},A.propagatePointChange=(D,E)=>{let F=A.lastChild();if(!F){if('Match'==r)return A.newChild().newChild().change[E](D);if('Set'==r)return A.newChild().change[E](D)}return!t&&A.complete()?{result:!1}:F.complete()?A.newChild().change[E](D):F.change[E](D)},A.change.games=(D)=>{if(!g(D)||2!=D.length)return!1;if('Game'==r)return{result:!1};if('Set'==r){if(A.complete())return{result:!1};let F={action:'changeGames',result:!0,gameChange:{from:A.counter,to:D}};return A.local_history.push(F),z.history.push(F),A.counter=D,F}let E=A.lastChild();return E||'Match'!=r?!t&&A.complete()?{result:!1}:E.complete()?A.newChild().change.games(D):E.change.games(D):A.newChild().change.games(D)},A.undo=(D=1)=>{if(isNaN(D))return!1;if('Game'!=r&&!A.children.length&&!A.local_history.length)return!1;if(!z.history.length)return!1;let E=()=>{let G=z.history[z.history.length-1].action;return C[G]()},F=[...Array(D).keys()].map(()=>E());return z.events.undo().forEach((G)=>G(F)),1==D?F[0]:F};let C={};return C.addPoint=()=>{if('Game'==r){A.local_history.pop();let D=z.history.pop();return A.counter[D.point.winner]-=1,z.removeStatPoint(D),D.point}return A.propagateUndo()},C.changePoints=()=>{if('Game'==r){A.local_history.pop();let D=z.history.pop();return A.counter=D.pointChange.from,D}return A.propagateUndo()},C.changeGames=()=>{if('Set'==r){A.local_history.pop();let D=z.history.pop();return A.counter=D.gameChange.from,D}return A.propagateUndo()},A.propagateUndo=()=>{let D=A.lastChild(),E=D.complete(),F=D.undo();if(E){let G=A.local_history.pop();G&&void 0!=G.winner&&(A.counter[G.winner]-=1)}return D.history.local().length||void 0!=D.lastChild()||A.children.pop(),F},A},h.Match=({index:q,type:r,common:t=h.common()}={})=>{let w=h.matchFormat({type:r,common:t}),z=h.stateObject({index:q,object:'Match',format:w,child:{object:'Set',label:'set',plural:'sets'},common:t});return z.scoreboard=(A)=>{return z.children.length?(void 0==A&&(A=z.set.perspectiveScore()?z.nextService():void 0),z.children.map((B)=>B.scoreboard(A)).join(', ')):'0-0'},{set:z.set,reset:z.reset,format:z.format,events:t.events,assignParser:t.assignParser,metadata:t.metadata,nextService:z.nextService,nextTeamServing:z.nextTeamServing,nextTeamReceiving:z.nextTeamReceiving,change:z.change,undo:z.undo,addPoint:z.addPoint,addPoints:z.addPoints,decoratePoint:z.decoratePoint,addScore:z.addScore,addScores:z.addScores,complete:z.complete,winner:z.winner,score:z.score,scoreboard:z.scoreboard,[z.child.plural]:z.accessChildren,history:z.history,stats:t.stats}},h.Set=({index:q,parent_object:r,type:t,common:u=h.common()}={})=>{let z=h.setFormat({type:t,common:u}),A=h.stateObject({index:q,parent_object:r,object:'Set',format:z,child:{object:'Game',label:'game',plural:'games'},common:u});A.pointsNeeded=()=>{if(!A.complete()){let C=A.format.threshold(),D=A.format.hasDecider(),E=A.scoreDifference(),F=A.format.minDiff(),G=[!1,!1],H=A.counter.map((K,L)=>{let M=A.counter[1-L];return K>M?M==C&&D?0:K>=C&&E>=F?0:K>=C-1?1:C-K:M>K?(G[L]=D&&C==M,K==C&&D?0:M>=C&&E>=F?0:G[L]?E+1:M>=C-1?E+F:C-K):(G[L]=D&&C==K&&C==M||1==F&&C==K&&C==M||0==F&&C-1==K&&C-1==M,G[L]?1:K>=C-1?F:C-K)}),I=A.lastChild(),J=H.map((K,L)=>{let M=0;if(I&&!I.complete()&&(M+=I.pointsToGame()[L],K-=1),!K)return M;G[L]&&(M+=A.format.decidingChild.threshold(),K-=1);for(let N=K;N;N--)M+=A.format.children.threshold();return M});return{points_to_set:J,games_to_set:H}}};let B=([C,D],[E,F])=>{return(E||F)&&(E>F&&(D+=`(${F})`),F>E&&(C+=`(${E})`)),`${C}-${D}`};return A.scoreboard=(C)=>{let D=A.lastChild(),E=A.perspectiveScore(A.counter,C);if(!D)return E.join('-');let F=!0==D.format.tiebreak();if(D.complete()&&!F)return E.join('-');if(!D.complete())return`${E.join('-')} (${D.scoreboard(C)})`;let G=D.score().counters.local,H=A.perspectiveScore(G,C);if(F&&A.complete()&&1==A.children.length)return H.join('-');let I=D.format.threshold();return B(E,H,I)},{set:A.set,reset:A.reset,format:A.format,events:u.events,assignParser:u.assignParser,metadata:u.metadata,nextService:A.nextService,nextTeamServing:A.nextTeamServing,nextTeamReceiving:A.nextTeamReceiving,change:A.change,undo:A.undo,addPoint:A.addPoint,addPoints:A.addPoints,decoratePoint:A.decoratePoint,addScore:A.addScore,addScores:A.addScores,complete:A.complete,winner:A.winner,score:A.score,scoreboard:A.scoreboard,[A.child.plural]:A.accessChildren,children:A.accessChildren,lastChild:A.lastChild,newChild:A.newChild,history:A.history,pointsNeeded:A.pointsNeeded}},h.Game=({index:q,parent_object:r,type:t,common:u=h.common()}={})=>{let z=h.gameFormat({type:t,common:u}),A=h.stateObject({index:q,object:'Game',parent_object:r,format:z,child:{object:'Point',label:'point',plural:'points'},common:u});return A.pointsToGame=()=>{if(!A.complete()){let B=A.format.threshold(),C=A.format.hasDecider(),D=A.scoreDifference(),E=A.format.minDiff(),F=A.counter.map((G,H)=>{let I=A.counter[1-H];return G>I?I==B&&C?0:G>=B&&D>=E?0:G>=B-1?1:B-G:I>G?G==B&&C?0:I>=B&&D>=E?0:I==B&&C?D+1:I>=B-1?D+E:B-G:C&&B==G&&B==I?1:G>=B-1?E:B-G});return F}},A.scoreboard=(B)=>{let C,D=A.format.threshold(),E=A.format.minDiff(),F=A.perspectiveScore(A.counter,B),G=4!=D||!0==A.format.tiebreak();if(G)return F.join('-');if(!A.thresholdMet()||A.singleThresholdMet()&&A.minDifferenceMet()||A.singleThresholdMet()&&A.format.hasDecider()&&1==E){let H=['0','15','30','40','G','G'];C=F.map((I)=>H[I]).join('-')}else C=F.map((H,I)=>{let J=F[1-I],K=H-D,L=J-D;return K>L&&A.minDifferenceMet()?'G':K>L?'A':'40'}).join('-');return 0<=C.indexOf('G')?'0-0':C},{set:A.set,reset:A.reset,format:A.format,events:u.events,assignParser:u.assignParser,metadata:u.metadata,nextService:A.nextService,nextTeamServing:A.nextTeamServing,nextTeamReceiving:A.nextTeamReceiving,change:A.change,undo:A.undo,addPoint:A.addPoint,addPoints:A.addPoints,decoratePoint:A.decoratePoint,addScore:A.addScore,addScores:A.addScores,complete:A.complete,winner:A.winner,score:A.score,scoreboard:A.scoreboard,history:A.history,lastChild:A.lastChild,pointsToGame:A.pointsToGame}},h.defaultPointParser=d;var k={'40-40':['G-40','40-G']},l={'0-0':['15-0','0-15'],'0-15':['15-15','0-30'],'0-30':['15-30','0-40'],'0-40':['15-40','0-G'],'15-0':['30-0','15-15'],'15-15':['30-15','15-30'],'15-30':['30-30','15-40'],'15-40':['30-40','15-G'],'30-0':['40-0','30-15'],'30-15':['40-15','30-30'],'30-30':['40-30','30-40'],'30-40':['40-40','30-G'],'40-0':['G-0','40-15'],'40-15':['G-15','40-30'],'40-30':['G-30','40-40'],'40-40':['A-40','40-A'],'A-40':['G-40','40-40'],'40-A':['40-40','40-G']};h.matchFormat=({type:r='3_6a_7',common:q}={})=>{let t=h.formatObject({plural:'matches',common:q});return t.children=h.setFormat({common:q}),t.decidingChild=h.setFormat({common:q}),t.init(r),{description:t.description,singles:t.singles,doubles:t.doubles,settings:t.settings,type:t.type,types:t.types,threshold:t.threshold,hasDecider:t.hasDecider,minDiff:t.minDiff,children:t.children,decidingChild:t.decidingChild}},h.setFormat=({type:r='AdSetsTo6tb7',common:q}={})=>{let t=h.formatObject({plural:'sets',common:q});return t.children=h.gameFormat({common:q}),t.decidingChild=h.gameFormat({common:q,type:'tiebreak7a'}),t.init(r),{description:t.description,singles:t.singles,doubles:t.doubles,settings:t.settings,type:t.type,types:t.types,threshold:t.threshold,hasDecider:t.hasDecider,minDiff:t.minDiff,children:t.children,decidingChild:t.decidingChild}},h.gameFormat=({type:r='advantage',common:q}={})=>{let t=h.formatObject({plural:'games',common:q});return t.init(r),{description:t.description,settings:t.settings,singles:t.singles,doubles:t.doubles,type:t.type,types:t.types,threshold:t.threshold,hasDecider:t.hasDecider,minDiff:t.minDiff,tiebreak:t.tiebreak}},h.formatObject=({plural:q,common:r=h.common()}={})=>{let t={values:{plural:q},singles:r.singles,doubles:r.doubles,init(u){0<=t.types(t.values.plural).indexOf(u)&&(t.type(u),t.values.initial_code=u)},types(u=t.values.plural){return Object.keys(j[u])},type(u){if(!t.values.plural)return!1;if(!0==u&&t.values.initial_code&&(u=t.values.initial_code),0<=t.types(t.values.plural).indexOf(u)){let w=j[t.values.plural][u];return t.hasDecider(w.hasDecider).minDiff(w.minDiff).threshold(w.threshold),void 0!=w.tiebreak&&t.tiebreak(w.tiebreak),t.name(w.name),t.description(w.description),t.values.code=u,w.children&&t.children.type(w.children),w.decidingChild&&t.decidingChild.type(w.decidingChild),!0}},settings({name:u,description:w,code:z,players:A,threshold:B,has_decider:C,min_diff:D,tiebreak:E}={}){if(z)t.type(z);else{if(!B||!C||!D||!E){let F='function'==typeof r.singles?r.singles()?2:4:'',G={name:t.values.name,description:t.values.description,code:t.values.code,players:F,threshold:t.values.threshold,has_decider:t.values.has_decider,min_diff:t.values.min_diff,tiebreak:t.values.tiebreak};return G}t.tiebreak(E),t.threshold(B),t.minDiff(D),t.hasDecider(C),w&&t.description(w),u&&t.name(u),A&&(4==A?t.doubles():t.singles())}},name(u){return arguments.length?('string'==typeof u&&(t.values.name=u),t):t.values.name},description(u){return arguments.length?('string'==typeof u&&(t.values.description=u),t):t.values.description},tiebreak(u){return arguments.length?(t.values.description=t.values.code=void 0,0<=[!0,!1].indexOf(u)&&(t.values.tiebreak=u),t):t.values.tiebreak},threshold(u){return arguments.length?(t.values.description=t.values.code=void 0,isNaN(u)||(t.values.threshold=u),t):t.values.threshold},minDiff(u){return arguments.length?(t.values.description=t.values.code=void 0,isNaN(u)||(t.values.min_diff=u),t):t.values.min_diff},hasDecider(u){return arguments.length?(t.values.description=t.values.code=void 0,0<=[!0,!1].indexOf(u)&&(t.values.has_decider=u),t):t.values.has_decider}};return t},h.common=()=>{function q(P,Q,R){let S=(X,Y)=>!X.filter((Z,$)=>Z!=Y[$]).length,T=(X,Y)=>Y.filter((Z)=>-1!=X.indexOf(Z)).length!=Y.length;if(!Array.isArray(P)||P.length!=C||T(P,[0,1])||T([0,1,2,3],P))return!1;let U=P.length==G[Q].length;if(S(P,G[Q])&&U)return J;let V=J.teams();G[Q]=P;let W=J.teams();return 4==P.length&&S(V[0],W[0])&&U&&r(G[Q],G[R],W)?J:(G[R]=P.map((X)=>P.length-1-X),J)}function r(P,Q,R){let S=(T,U)=>R.filter((V)=>1<V.filter((W)=>0<=[T,U].indexOf(W)).length).length;return!P.filter((T,U)=>S(T,Q[U])).length}function t(P,Q){let R=[];return[...Array(P).keys()].map(()=>{let S=u(R,Q);return R.push(S),S})}function u(P,Q){let R=w(P.length),S=2>(P.length+1)%4,T=P[P.length-1],U=void 0==T?void 0==Q?G.service_order[0]:Q:T,V=S==R?U:O.advanceService(U);return V}function w(P){let Q=[!0].concat([...Array(P).keys()].map((R)=>2>(R+1)%4));return Q[P]}function z(){if(2==C){let P=O.metadata.serviceOrder();if(2==P.length)return;O.metadata.serviceOrder(P.filter((Q)=>0<=[0,1].indexOf(Q)))}else{let P=O.metadata.serviceOrder();if(4==P.length)return;let Q=P.slice();P.forEach((R)=>Q.push(R+2)),O.metadata.serviceOrder(Q)}}function A(P){if(!P||!P.teams)return[];let R={Aces:{numerators:['aces'],calc:'number'},'Double Faults':{numerators:['doubleFaults'],calc:'number'},'First Serve %':{numerators:['serves1stIn'],denominators:['pointsServed'],calc:'percentage'},'Unforced Errors':{numerators:['unforcedErrors'],calc:'number'},'Forced Errors':{numerators:['forcedErrors'],calc:'number'},Winners:{numerators:['winners'],calc:'number'},'Total Points Won':{numerators:['pointsWon'],calc:'number'},'Max Pts/Row':{numerators:['pointsWon'],calc:'maxConsecutive',attribute:'index'},'Max Games/Row':{numerators:['gamesWon'],calc:'maxConsecutive',attribute:'game'},'Total Points Won':{numerators:['pointsWon'],calc:'number'},'Points Won 1st':{numerators:['serves1stWon'],denominators:['serves1stIn'],calc:'percentage'},'Points Won 2nd':{numerators:['serves2ndWon'],denominators:['serves2ndIn'],calc:'percentage'},'Points Won Receiving':{numerators:['received1stWon','received2ndWon'],denominators:['-pointsServed'],calc:'percentage'},'Breakpoints Saved':{numerators:['breakpointsSaved'],denominators:['breakpointsFaced'],calc:'percentage'},'Breakpoints Converted':{numerators:['-breakpointsSaved'],denominators:['-breakpointsFaced'],calc:'difference'},'Aggressive Margin':{calc:'aggressiveMargin',numerators:['*doubleFaults','*unforcedErrors'],denominators:['*aces','*winners','-*forcedErrors']}},S=(Y,Z,$)=>{if(Y){let _=Y.map((aa)=>{let ba=aa.split('-').reverse()[0].split('*').join(''),ca=Z[0==aa.indexOf('-')?1-$:$];return ca&&ca[ba]?ca[ba].length:0});return[].concat(0,0,..._).reduce((aa,ba)=>aa+ba)}},T=(Y,Z,$)=>{let _=S(Y.numerators,Z,$),aa=S(Y.denominators,Z,$);return{numerator:_,denominator:aa}},U=(Y,Z)=>{let $=Math.round(100*(Y/Z));return{value:$,display:`${$}% (${Y}/${Z})`}},V={number(Y,Z,$){return({numerator,denominator}=T(Y,Z,$)),{display:numerator,value:numerator,numerators:Y.numerators}},maxConsecutive(Y,Z,$){let _=Y.numerators[0],aa=Y.attribute,ba=Z[$][_];if(!ba)return{value:0,display:0};let ca,da=0,ea=ba.length?1:0;return ba.forEach((fa)=>{ca+1==fa.point[aa]?ea+=1:(ea>da&&(da=ea),ea=1),ca=fa.point[aa]}),ea>da&&(da=ea),{display:da,value:da}},percentage(Y,Z,$){return({numerator,denominator}=T(Y,Z,$)),void 0!=numerator&&denominator?Object.assign(U(numerator,denominator),{numerators:Y.numerators}):{value:0,display:0}},difference(Y,Z,$){if(({numerator,denominator}=T(Y,Z,$)),void 0==numerator||!denominator)return{value:0,display:0};let _=Math.abs(denominator-numerator);return Object.assign(U(_,denominator),{numerators:Y.numerators})},aggressiveMargin(Y,Z,$){({numerator,denominator}=T(Y,Z,$));let _=denominator-numerator,aa=Object.keys(Z).map((ca)=>Z[ca].pointsWon?Z[ca].pointsWon.length:0),ba=[].concat(0,0,...aa).reduce((ca,da)=>ca+da);return Object.assign(U(_,ba),{numerators:Y.numerators})}},W=[].concat(...Object.keys(P.teams).map((Y)=>Object.keys(P.teams[Y]))),X=Object.keys(R).map((Y)=>{let Z=R[Y];Z.denominators||(Z.denominators=[]);let $=[].concat(...Z.numerators,...Z.denominators).map((ba)=>ba.split('-').reverse()[0]);$=$.filter((ba)=>0>ba.indexOf('*'));let _=1>$.map((ba)=>0>W.indexOf(ba)).filter((ba)=>ba).length;if(!_)return!1;let aa=[0,1].map((ba)=>{return V[Z.calc](Z,P.teams,ba)});return{name:Y,team_stats:aa}}).filter((Y)=>Y);return X}function B({player:P,team:Q,episode:R,stat:S}){void 0!=P&&(!H.players[P]&&(H.players[P]={}),!H.players[P][S]&&(H.players[P][S]=[]),R&&H.players[P][S].push(R),Q=J.playerTeam(P)),void 0!=Q&&(!H.teams[Q]&&(H.teams[Q]={}),!H.teams[Q][S]&&(H.teams[Q][S]=[]),R&&H.teams[Q][S].push(R))}let H,I,C=2,D=h.addPoint_events.slice(),E=h.undo_events.slice(),F=h.reset_events.slice(),G={},J={resetStats(){H=void 0,I=void 0},reset(){G={players:[],teams:[],service_order:[0,1],receive_order:[1,0],tournament:{},match:{},timestamps:!1,charter:void 0}},timestamps(P){return arguments.length?(0<=[!0,!1].indexOf(P)&&(G.timestamps=P),J):G.timestamps},serviceOrder(P){return arguments.length?q(P,'service_order','receive_order'):G.service_order.slice()},doublesServiceChange(){if(4!=C)return!1},receiveOrder(P){return arguments.length?q(P,'receive_order','service_order'):G.receive_order.slice()},teams(){let P=[];return P[0]=G.service_order.filter((Q,R)=>(R+1)%2).sort(),P[1]=G.service_order.filter((Q,R)=>R%2).sort(),P.sort(),P},playerTeam(P){return J.teams().map((Q)=>0<=Q.indexOf(P)).indexOf(!0)},teamPlayers(){return J.teams().map((P)=>P.map((Q)=>J.players(Q).name))},players(P){return arguments.length?isNaN(P)||0>P||3<P?!1:G.players[P]?G.players[P]:{name:`Player ${['One','Two','Three','Four'][P]}`}:G.players.length>G.service_order.length?G.players:G.service_order.map((Q)=>J.players(Q))},definePlayer({index:P,name:Q,birth:R,puid:S,hand:T,seed:U,rank:V,age:W,entry:X,ioc:Y,draw_position:Z}={}){void 0==P&&(P=G.players.length);let $=G.players[P]||{};if(!Q&&!$.name||isNaN(P)||3<P)return!1;let _={name:Q,birth:R,puid:S,hand:T,seed:U,rank:V,age:W,entry:X,ioc:Y,draw_position:Z};return Object.keys(_).forEach((aa)=>{_[aa]&&($[aa]=_[aa])}),G.players[P]=$,{index:P,player:$}},defineTournament({name:P,tuid:Q,start_date:R,tour:S,rank:T,surface:U,in_out:V,draw:W,draw_size:X,round:Y,level:Z}={}){let $={name:P,tuid:Q,start_date:R,tour:S,rank:T,surface:U,in_out:V,draw:W,draw_size:X,round:Y,level:Z};return Object.keys($).forEach((_)=>{$[_]&&(G.tournament[_]=$[_])}),G.tournament},defineMatch({muid:P,date:Q,gender:R,year:S,court:T,start_time:U,end_time:V,duration:W,status:X,umpire:Y,official_score:Z}={}){let $={muid:P,date:Q,gender:R,year:S,court:T,start_time:U,end_time:V,duration:W,status:X,umpire:Y,official_score:Z};return Object.keys($).forEach((_)=>{$[_]&&(G.match[_]=$[_])}),G.match},showTiebreakOrder(P){return t(12,P)}},O={metadata:J,pointParser:h.pointParser,events:{addPoint:(P)=>{return P?void('function'==typeof P?D.push(P):'array'==typeof P&&P.foreach(e)((Q)=>{'function'==typeof Q&&D.push(c)})):D},undo:(P)=>{return P?void('function'==typeof P?E.push(P):'array'==typeof P&&P.foreach(e)((Q)=>{'function'==typeof Q&&E.push(c)})):E},clearEvents:()=>{D=[],E=[],F=[]},reset:(P)=>{return P?void('function'==typeof P?F.push(P):'array'==typeof P&&P.foreach(e)((Q)=>{'function'==typeof Q&&F.push(c)})):F}},history:[],live_stats:!1,perspective_score:!1,assignParser(P){O.pointParser=P},advanceService(P){let Q=G.service_order.indexOf(P)+1;return G.service_order[Q<J.players().length?Q:0]},nextTiebreakService(P,Q){let R=t(P.length+1,Q);return R[R.length-1]},singles(P){return arguments.length?(C=P?2:4,z(),O):2==C},doubles(P){return arguments.length?(C=P?4:2,z(),O):4==C},stats:{calculated(P){return A(O.stats.counters(),P)},counters(){if(!H){O.live_stats=!0;let P=O.history.filter((Q)=>'addPoint'==Q.action);P.forEach((Q)=>O.addStatPoint(Q))}return H}},addStatPoint(P){if(O.live_stats){let Q=P.point;H||(H={players:{},teams:{}});let R=J.playerTeam(Q.server),S=J.playerTeam(Q.winner),T=1-S;B({player:Q.server,episode:P,stat:'pointsServed'}),B({team:S,episode:P,stat:'pointsWon'}),'Ace'==Q.result&&B({player:Q.server,episode:P,stat:'aces'}),'Double Fault'==Q.result&&B({player:Q.server,episode:P,stat:'doubleFaults'}),'Winner'==Q.result&&B({player:Q.winner,episode:P,stat:'winners'}),'Unforced Error'==Q.result&&B({team:T,episode:P,stat:'unforcedErrors'}),'Forced Error'==Q.result&&B({team:T,episode:P,stat:'forcedErrors'}),Q.first_serve||B({player:Q.server,episode:P,stat:'serves1stIn'}),Q.first_serve||Q.winner!=R||(B({player:Q.server,episode:P,stat:'serves1stWon'}),B({team:T,undefined:void 0,stat:'received1stWon'}),B({team:T,undefined:void 0,stat:'received2ndWon'})),Q.first_serve||Q.winner==R||B({team:S,episode:P,stat:'received1stWon'}),Q.first_serve&&'Double Fault'!=!Q.result&&B({player:Q.server,episode:P,stat:'serves2ndIn'}),Q.first_serve&&'Double Fault'!=!Q.result&&Q.winner==Q.server&&(B({player:Q.server,episode:P,stat:'serves2ndWon'}),B({team:T,undefined:void 0,stat:'received1stWon'}),B({team:T,undefined:void 0,stat:'received2ndWon'})),Q.first_serve&&'Double Fault'!=!Q.result&&Q.winner!=R&&B({team:S,episode:P,stat:'received2ndWon'}),Q.breakpoint&&(B({player:Q.server,undefined:void 0,stat:'breakpointsSaved'}),B({player:Q.server,episode:P,stat:'breakpointsFaced'})),I&&I.point.breakpoint&&I.point.server==Q.winner&&B({player:Q.server,episode:P,stat:'breakpointsSaved'}),P.game&&P.game.complete&&B({team:S,episode:P,stat:'gamesWon'}),I=P}},removeStatPoint(P){if(O.live_stats){Object.keys(H).forEach((R)=>{Object.keys(H[R]).forEach((S)=>{Object.keys(H[R][S]).forEach((T)=>{H[R][S][T].length&&(H[R][S][T]=H[R][S][T].filter((U)=>U.point.index!=P.point.index))})})});let Q=O.history.filter((R)=>'addPoint'==R.action);I=Q.length?Q[Q.length-1]:void 0}}};return J.reset(),O},'function'==typeof define&&define.amd?define(h):'object'==typeof module&&module.exports&&(module.exports=h),this.umo=h}();

