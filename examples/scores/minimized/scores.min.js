function setOrientation(){orientation=window.innerHeight>window.innerWidth?"portrait":"landscape"}function zeroPad(e){return e.toString()[1]?e:"0"+e}function updateScore(e){var n=e.score,t=e.serving,o=n.points.split("-"),r=e.players,i=Array.from(document.querySelectorAll(".display_player_0"));i.forEach(function(e){return e.innerHTML=r[0].name}),i.forEach(function(n){return n.style.color=t||e.complete?"white":"yellow"});var s=Array.from(document.querySelectorAll(".display_player_1"));s.forEach(function(e){return e.innerHTML=r[1].name}),s.forEach(function(n){return n.style.color=t&&!e.complete?"yellow":"white"});var c=Array.from(document.querySelectorAll(".display_points_0"));c.forEach(function(e){e.innerHTML=o[0]}),c.forEach(function(n){n.style.color=e.complete?"black":t?"white":"yellow"});var a=Array.from(document.querySelectorAll(".display_points_1"));a.forEach(function(e){e.innerHTML=o[1]}),a.forEach(function(n){n.style.color=e.complete?"black":t?"yellow":"white"});var l=n.components.sets;if(l){l.forEach(function(e,n){Array.from(document.getElementsByClassName("hs"+n)).forEach(function(e){e.style.display="flex"}),Array.from(document.getElementsByClassName("display_set_"+n+"_games_0")).forEach(function(n){n.innerHTML=e.games[0]}),Array.from(document.getElementsByClassName("display_set_"+n+"_games_1")).forEach(function(n){n.innerHTML=e.games[1]})});for(var f=l.length;f<5;f++){Array.from(document.getElementsByClassName("hs"+f)).forEach(function(e){e.style.display="none"})}}}function updatePointHistory(e){var n=e.point;document.getElementById("pointhistory").style.display="block";var t=n?n.winner:0,o="",r=n&&n.result?n.result.toLowerCase():"";r.indexOf("ace")>=0?o="winner":r.indexOf("winner")>=0?o="winner":r.indexOf("unforced")>=0?(o="unforced",t=1-t):r.indexOf("fault")>=0?(o="fault",t=1-t):r.indexOf("forced")>=0&&(o="forced",t=1-t);var i="<span class="+(o||"")+">"+(n&&n.result?n.result:"")+"</span>",s=n?[n.hand,n.stroke].filter(function(e){return e}).join(" "):"",c='<span class="hand_stroke">'+s+"</span>",a=n&&n.uts?new Date(n.uts):"",l=n?n.score:e.score.points;"0-0"==l&&""!=a&&(l="GAME");var f=t?"":'<div class="flexjustifystart">'+(t?"&nbsp;":c)+'</div><div class="r_left flexjustifyend">'+(t?"&nbsp;":i)+"</div>",d=t?'<div class="r_right flexjustifystart">'+(t?i:"&nbsp;")+'</div><div class="flexjustifyend">'+(t?c:"&nbsp;")+"</div>":"",u=a?[a.getHours(),zeroPad(a.getMinutes()),zeroPad(a.getSeconds())].join(":"):"",m='<div class="time '+(t?"flexjustifystart":"flexjustifyend")+'">'+u+"</div>",y='<div class="time flexcenter">Undo</div>';e.undo&&(f=y,d=y);var p='<div class="flexrows result_row"><div class="result_player0 flexrows">'+(f||m)+'</div><div class="flexcenter score">'+l+'</div><div class="result_player1 flexrows">'+(d||m)+"</div></div>",v=document.getElementById("updates"),h=document.createElement("LI");if(h.innerHTML=p,v.insertBefore(h,v.firstChild),e.complete){p='<div class="flexcenter complete">MATCH COMPLETE</div>';var g=document.createElement("LI");g.innerHTML=p,v.insertBefore(g,v.firstChild)}document.getElementById("details").scrollTop=0}function init(){coms.socket=io.connect("/match",coms.connectionOptions),coms.socket.on("connect",function(){console.log("connected"),okeys.indexOf("muid")>=0&&coms.socket.emit("join match",QueryString.muid)}),coms.socket.on("disconnect",function(){console.log("disconnected")}),coms.socket.on("point history",function(e){if(e){var n=JSON.parse("["+e.join(",")+"]");point=n.sort(function(e,n){return e.uts-n.uts}),d3.select("#updates").html(""),n.forEach(function(e){updatePointHistory({point:e})})}}),coms.socket.on("match details",function(e){updateScore(e)}),coms.socket.on("match score",function(e){updateScore(e),updatePointHistory(e)}),coms.socket.on("messages",function(e){})}var orientation;window.addEventListener("orientationchange",function(){setOrientation()},!1),setOrientation();var coms={socket:void 0,connectionOptions:{"force new connection":!0,reconnectionDelay:1e3,reconnectionAttempts:"Infinity",timeout:2e4}},QueryString=function(){for(var e={},n=window.location.search.substring(1),t=n.split("&"),o=0;o<t.length;o++){var r=t[o].split("=");if(void 0===e[r[0]])e[r[0]]=r[1];else if("string"==typeof e[r[0]]){var i=[e[r[0]],r[1]];e[r[0]]=i}else e[r[0]].push(r[1])}return e}(),okeys=Object.keys(QueryString);init();