"use strict";function _toConsumableArray(t){if(Array.isArray(t)){for(var n=0,e=Array(t.length);n<t.length;n++)e[n]=t[n];return e}return Array.from(t)}function _defineProperty(t,n,e){return n in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e,t}function ptsMatch(){function t(t){if(a=t,o.display.sizeToFit){var n=t.node().getBoundingClientRect();o.width=Math.max(n.width,300)}for(var e=a.append("div").attr("class",o.class+"root").style("width",o.width+"px").style("height",o.height+"px"),u=0;u<5;u++)s[u]=e.append("div").attr("class","pts").style("display","none"),s[u].call(l[u]);i=function(n){var i=r.sets();if(o.display.sizeToFit||n&&n.sizeToFit){var a=t.node().getBoundingClientRect();o.width=Math.max(a.width,300),o.height=(a.height-(+o.margins.top+ +o.margins.bottom))/i.length,o.height>o.max_height&&(o.height=o.max_height)}for(var u=0,c=0;c<l.length;c++)i[c]&&i[c].history.points().length?(s[c].style("display","inline"),l[c].width(o.width),l[c].height(o.height),l[c].update(),u+=+o.height+5):s[c].style("display","none");e.style("width",o.width+"px").style("height",u+"px")}}function n(t,e){if(t&&e)for(var r=Object.keys(t),i=Object.keys(e),a=0;a<r.length;a++)if(i.indexOf(r[a])>=0){var o=e[r[a]],s=t[r[a]];"object"==(void 0===o?"undefined":_typeof(o))&&"function"!=typeof s&&o&&o.constructor!==Array?n(t[r[a]],e[r[a]]):e[r[a]]=t[r[a]]}}for(var e,r,i,a,o={id:0,class:"ptsMatch",resize:!0,width:window.innerWidth,height:80,max_height:100,margins:{top:0,right:0,bottom:0,left:0},set:{average_points:56},lines:{width:2,interpolation:"linear"},points:{max_width_points:100},score:{font:"Arial",font_size:"12px",font_weight:"bold",reverse:!0},header:{font:"Arial",font_size:"14px",font_weight:"bold"},display:{sizeToFit:!0,transition_time:0,point_highlighting:!0,point_opacity:.4,win_err_highlight:!0,game_highlighting:!0,game_opacity:.2,game_boundaries:!0,gamepoints:!1,score:!0,points:!0,winner:!0},colors:{orientation:"yellow",gamepoints:"black",players:{0:"#a55194",1:"#6b6ecf"}}},s=[],l=[],u=0;u<5;u++)l.push(ptsChart());var c=(e={update:{begin:null,end:null},set_box:{mouseover:null,mouseout:null}},_defineProperty(e,"update",{begin:null,end:null}),_defineProperty(e,"point_bars",{mouseover:null,mouseout:null,click:null}),e);return t.options=function(e){return arguments.length?(n(e,o),t):o},t.events=function(e){return arguments.length?(n(e,c),t):c},t.colors=function(n){return arguments.length?(o.colors.players=n,t):o.colors},t.width=function(n){return arguments.length?(o.width=n,"function"==typeof i&&i(!0),l.forEach(function(t){t.width(n)}),t):o.width},t.height=function(n){return arguments.length?(o.height=n,"function"==typeof i&&i(!0),l.forEach(function(t){t.height(n)}),t):o.height},t.duration=function(n){return arguments.length?(o.display.transition_time=n,t):o.display.transition_time},t.update=function(n){c.update.begin&&c.update.begin();var e=r.sets(),a=Math.max.apply(Math,_toConsumableArray(e.map(function(t,n){return t.history.points().filter(function(t){return t.set==n}).length})));return e.length>1&&t.options({points:{max_width_points:a}}),e.forEach(function(t,r){l[r].data(e[r]),l[r].options({id:r}),l[r].options({lines:o.lines,points:o.points,score:o.score,header:o.header}),l[r].options({set:o.set,display:o.display,colors:o.colors}),l[r].events(c),l[r].width(o.width).height(o.height).update(n)}),"function"==typeof i&&i(n),setTimeout(function(){c.update.end&&c.update.end()},o.display.transition_time),!0},t.data=function(n){if(!arguments.length)return r;r=n,t.update()},t}function ptsChart(){function t(t){t.each(function(){var t=(o=d3.select(this)).append("svg").attr("class",u.class+"root").style("width",u.width+"px").style("height",u.height+"px"),p=t.append("g").attr("class",u.class+"pts").attr("transform","translate(5, 5)"),d=t.append("g").attr("class",u.class+"pts").attr("transform","translate(5, 5)"),f=p.append("text").attr("class",u.class+"Header").attr("opacity",0).attr("font-size",u.header.font_size).attr("font-weight",u.header.font_weight).attr("x",function(t,n){return u.margins.left+"px"}).attr("y",function(t,n){return u.margins.top+8+"px"}),h=p.append("text").attr("class",u.class+"Score").attr("opacity",0).attr("font-size",u.score.font_size).attr("font-weight",u.score.font_weight).attr("x",function(t,n){return u.margins.left+"px"}).attr("y",function(t,n){return u.margins.top+20+"px"}),g=p.append("text").attr("class",u.class+"Points").attr("opacity",0).attr("font-size",u.score.font_size).attr("font-weight",u.score.font_weight).attr("x",function(t,n){return u.margins.left+40+"px"}).attr("y",function(t,n){return u.margins.top+20+"px"});a=function(a,o){function y(t,n,e){return A(t.range[n]<b?t.range[n]+e:t.range[n]+e-b)}function m(t){var n=t.split(" ");return n[n.length-1]}function _(t){var n=e.winner(),r=e.metadata.players(),i=void 0!=n?r[n].name:m(r[0].name)+"/"+m(r[1].name);f.transition().duration(t?0:u.display.transition_time).attr("opacity",1).attr("fill",void 0!=n?u.colors.players[n]:"black").text(i);var a=e.scoreboard(n);h.transition().duration(t?0:u.display.transition_time).attr("opacity",1).attr("fill",void 0!=n?u.colors.players[n]:"black").text(a),g.transition().duration(100).attr("opacity",0)}if(!e)return!1;t.transition().duration(u.display.transition_time).style("width",u.width+"px").style("height",u.height+"px");var v=e.history.action("addPoint").filter(function(t){return t.point.set==u.id}),b=v[0].point.index;r=function(t){var n=[{points:[],range:[0,0]}],e=0,r=0;return t.forEach(function(t){var i=t.point;i.game!=r&&(e+=1,r=i.game,n[e]={points:[],range:[i.index,i.index]}),n[e].points.push(i),n[e].index=e,n[e].set=t.set.index,n[e].score=t.game.games,n[e].complete=t.game.complete,n[e].range[1]=i.index,t.game.complete&&(n[e].winner=i.winner)}),n}(v),i=v.map(function(t){return t.needed.points_to_set});var x=Math.max.apply(Math,_toConsumableArray([].concat(i.map(function(t){return t[0]}),i.map(function(t){return t[1]})))),w=Math.max.apply(Math,_toConsumableArray(i[0]));i.unshift([w,w]);var k=Math.max.apply(null,v.map(function(t){return t.point.rally?t.point.rally.length:0}))+2;_(o);var A=d3.scaleLinear().domain([0,function(){var t=e.history.points().filter(function(t){return t.set==u.id}).length-1;return Math.max(t,u.points.max_width_points,u.set.average_points)}()]).range([0,u.width-(u.margins.left+u.margins.right)]),O=d3.scaleLinear().range([u.height-(u.margins.top+u.margins.bottom),u.margins.bottom]).domain([-2,x-1]),z=p.selectAll("."+u.class+"SetBox").data([u.id]);z.enter().append("rect").attr("class",u.class+"SetBox").style("position","relative").attr("height",function(){return u.height-(u.margins.top+u.margins.bottom)}).attr("width",function(){return A(n()+1)}).attr("stroke","black").attr("stroke-width",1).attr("fill","none").on("mouseover",function(t,n){c.set_box.mouseover&&c.set_box.mouseover(t,n)}).on("mouseout",function(t,n){c.set_box.mouseout&&c.set_box.mouseout(t,n)}).merge(z).transition().duration(o?0:u.display.transition_time).attr("height",function(){return u.height-(u.margins.top+u.margins.bottom)}).attr("width",function(){return A(n()+1)}),z.exit().transition().duration(o?0:u.display.transition_time).style("opacity",0).remove();var B=p.selectAll("."+u.class+"GameBoundary").data(r);B.exit().remove(),B.enter().append("rect").attr("class",u.class+"GameBoundary").merge(B).attr("id",function(t,n){return u.class+u.id+"boundary"+n}).transition().duration(o?0:u.display.transition_time).attr("opacity",function(){return u.display.game_boundaries?.02:0}).attr("transform",function(t,n){return"translate("+y(t,0,0)+", 0)"}).attr("height",O(-2)).attr("width",function(t){return y(t,1,1)-y(t,0,0)}).attr("stroke","black").attr("stroke-width",1).attr("fill","none");var M=p.selectAll("."+u.class+"Game").data(r);M.exit().remove(),M.enter().append("rect").attr("class",u.class+"Game").merge(M).attr("id",function(t,n){return u.class+u.id+"game"+n}).transition().duration(o?0:u.display.transition_time).attr("opacity",function(){return u.display.game_boundaries?.02:0}).attr("transform",function(t,n){return"translate("+y(t,0,0)+", 0)"}).attr("height",O(-2)).attr("width",function(t){return y(t,1,1)-y(t,0,0)}).attr("stroke",function(t){return u.colors.players[t.winner]}).attr("stroke-width",1).attr("fill",function(t){return void 0!=t.winner?u.colors.players[t.winner]:"none"});var j=d3.line().x(function(t,n){return A(n)}).y(function(t){return O(x-t)}),S=p.selectAll("."+u.class+"Line").data([0,1]);S.exit().remove(),S.enter().append("path").attr("class",u.class+"Line").attr("id",function(t){return u.class+u.id+"player"+t+"Line"}).attr("fill","none").merge(S).transition().duration(o?0:u.display.transition_time/2).style("opacity",.1).transition().duration(o?0:u.display.transition_time/2).style("opacity",1).attr("stroke",function(t){return u.colors.players[t]}).attr("stroke-width",function(t){return u.lines.width}).attr("d",function(t){return j(i.map(function(n){return n[t]}))});var C=[i.map(function(t){return{pts:t[0]}}),i.map(function(t){return{pts:t[1]}})],P=p.selectAll("."+u.class+"BPWrapper").data(C);P.enter().append("g").attr("class",u.class+"BPWrapper"),P.exit().remove();var G=P.selectAll("."+u.class+"Breakpoint").data(function(t,n){return function(t,n){for(var e=0;e<t.length;e++)t[e]._i=n;return t}(t,n)});G.exit().attr("opacity","0").remove(),G.enter().append("circle").attr("class",u.class+"Breakpoint").attr("opacity","0").merge(G).transition().duration(o?0:u.display.transition_time/2).style("opacity",0).transition().duration(o?0:u.display.transition_time/2).attr("fill",function(t,n){if(v[n-1]&&void 0!=v[n-1].point.breakpoint)return u.colors.players[t._i]}).style("opacity",function(t,n){if(v[n-1]&&void 0!=v[n-1].point.breakpoint)return v[n-1].point.server==1-t._i?1:0}).attr("cx",function(t,n){return A(n)}).attr("cy",function(t){return O(x-t.pts)}).attr("r",2);var E=d3.range(v.length),F=d3.scaleBand().domain(E).range([0,A(v.length)]).round(!0),L=d3.scaleLinear().domain([0,v.length]).range([0,A(v.length)]);p.selectAll(".gradient"+u.id).remove();p.selectAll(".gradient"+u.id).data(d3.range(v.length)).enter().append("linearGradient").attr("id",function(t,n){return"gradient"+u.id+n}).attr("class",function(){return"gradient"+u.id}).attr("gradientUnits","userSpaceOnUse").attr("x1",function(t){return F.bandwidth()/2}).attr("y1",function(t){return 0}).attr("x2",function(t){return F.bandwidth()/2}).attr("y2",function(t){return O(-2)}).attr("transform",function(t,n){return"translate("+L(n)+", 0)"}).selectAll(".points_stop").data(function(t,n){return function(t,n){var e=0,r=0,i=0;if(u.display.win_err_highlight){var a=t.rally,o=t.result,c=a?100-Math.floor(a.length/k*100):100;s.indexOf(o)>=0?e=c:l.indexOf(o)>=0?r=c:i=c}return[{offset:"0%",color:"blue"},{offset:i+"%",color:"blue"},{offset:i+"%",color:"green"},{offset:i+e+"%",color:"green"},{offset:i+e+"%",color:"red"},{offset:i+e+r+"%",color:"red"},{offset:i+e+r+"%",color:u.colors.orientation},{offset:"100%",color:u.colors.orientation}]}(v[n].point)}).enter().append("stop").attr("class","points_stop").attr("offset",function(t){return t.offset}).attr("stop-color",function(t){return t.color}).attr("offset",function(t){return t.offset});var T=d.selectAll("."+u.class+"Bar").data(d3.range(v.length));T.exit().transition().duration(o?0:u.display.transition_time).attr("opacity","0").remove(),T.enter().append("line").attr("class",u.class+"Bar").attr("opacity","0").merge(T).attr("opacity","0").attr("transform",function(t,n){return"translate("+L(n)+", 0)"}).attr("x1",function(t){return F.bandwidth()/2}).attr("y1",function(t){return 0}).attr("x2",function(t){return F.bandwidth()/2}).attr("y2",function(t){return O(-2)}).attr("stroke-width",function(){return F.bandwidth()}).attr("stroke",function(t,n){return"url(#gradient"+u.id+n+")"}).attr("uid",function(t,n){return"point"+n}).on("mousemove",function(t,n){u.display.point_highlighting&&d3.select(this).attr("opacity",u.display.point_opacity),u.display.game_highlighting&&v[n]&&d3.select('[id="'+u.class+u.id+"game"+v[n].point.game+'"]').attr("opacity",u.display.game_opacity),c.point_bars.mouseover&&c.point_bars.mouseover(v[t],n),0==t&&d.selectAll("."+u.class+"Bar").attr("opacity",u.display.point_opacity),t+2!=i.length||0!=i[t+1][0]&&0!=i[t+1][1]||p.selectAll("."+u.class+"Game").attr("opacity",u.display.game_opacity),function(t){if(v[t]){var n=i[t+1],r=v[t].point.score,a=e.metadata.players(),o=n[0]<n[1]?1:n[0]>n[1]?0:void 0,s=void 0!=o?a[o].name:m(a[0].name)+"/"+m(a[1].name);f.transition().duration(100).attr("opacity",1).attr("fill",function(){return void 0!=o?u.colors.players[o]:"black"}).text(s),h.transition().duration(100).attr("opacity",1).attr("fill",function(){return void 0!=o?u.colors.players[o]:"black"}).text(v[t].game.games.join("-")),g.transition().duration(100).attr("opacity",1).attr("fill",function(){return void 0!=o?u.colors.players[o]:"black"}).text("0-0"!=r?r:"")}}(t)}).on("mouseout",function(t,n){d.selectAll("."+u.class+"Bar").attr("opacity",0),p.selectAll("."+u.class+"Game").attr("opacity","0"),c.point_bars.mouseout&&c.point_bars.mouseout(v[t],n),_()}).on("click",function(t,n){c.point_bars.click&&c.point_bars.click(v[t],n,this)})}})}function n(){var t=e.history.points().filter(function(t){return t.set==u.id}).length-1;return e.complete()?t:t<u.set.average_points?u.set.average_points:t}var e,r,i,a,o,s=["Ace","Winner","Serve Winner"],l=["Forced Error","Unforced Error","Double Fault","Penalty","Out","Net"],u={id:0,class:"ptsChart",resize:!0,width:window.innerWidth,height:80,margins:{top:5,right:15,bottom:5,left:5},set:{average_points:56},lines:{width:2,interpolation:"linear"},points:{max_width_points:100},score:{font:"Arial",font_size:"12px",font_weight:"bold",reverse:!0},header:{font:"Arial",font_size:"14px",font_weight:"bold"},display:{transition_time:0,point_highlighting:!0,point_opacity:.4,win_err_highlight:!0,game_highlighting:!0,game_opacity:.2,game_boundaries:!1,gamepoints:!1,score:!0,points:!0,winner:!0},colors:{orientation:"yellow",gamepoints:"black",players:{0:"blue",1:"purple"}}},c={set_box:{mouseover:null,mouseout:null},update:{begin:null,end:null},point_bars:{mouseover:null,mouseout:null,click:null}};return t.options=function(n){if(!arguments.length)return u;for(var e=Object.keys(n),r=Object.keys(u),i=0;i<e.length;i++)if(r.indexOf(e[i])>=0)if("object"==_typeof(u[e[i]]))for(var a=Object.keys(n[e[i]]),o=Object.keys(u[e[i]]),s=0;s<a.length;s++)o.indexOf(a[s])>=0&&(u[e[i]][a[s]]=n[e[i]][a[s]]);else u[e[i]]=n[e[i]];return t},t.data=function(t){if(!arguments.length)return e;e=t},t.events=function(n){if(!arguments.length)return c;for(var e=Object.keys(n),r=Object.keys(c),i=0;i<e.length;i++)r.indexOf(e[i])>=0&&(c[e[i]]=n[e[i]]);return t},t.colors=function(n){return arguments.length?(u.colors.players=n,t):u.colors},t.width=function(n){return arguments.length?(u.width=n,t):u.width},t.height=function(n){return arguments.length?(u.height=n,t):u.height},t.update=function(t){return c.update.begin&&c.update.begin(),"function"==typeof a&&a(t),setTimeout(function(){c.update.end&&c.update.end()},u.display.transition_time),!0},t.duration=function(n){return arguments.length?(u.display.transition_time=n,t):u.display.transition_time},t}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};